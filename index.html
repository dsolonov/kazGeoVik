<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Игра</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=2bc4db1f-55d0-4cfe-bb41-e925007c5578&lang=ru_RU"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
        #panorama {
            width: 100%;
            height: 100%;
        }
        #miniMapContainer {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 200px;
            height: 150px;
            border: 2px solid #ccc;
            z-index: 10;
            transition: all 0.3s ease;
        }
        #miniMap {
            width: 100%;
            height: 100%;
        }
        #miniMapContainer.expanded {
            width: 100vw;
            height: 50vh;
        }
        #miniMapButton {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 10px;
            font-size: 25px;
            z-index: 20;
        }
        #guessButton, #nextRoundButton, #showRatingButton {
            position: absolute;
            padding: 20px 55px;
            font-size: 32px;
            color: white;
            border: none;
            cursor: pointer;
            z-index: 20;
        }
        #guessButton {
            top: 10px;
            left: 15px;
            background-color: #4CAF50;
            display: none;
        }
        #nextRoundButton {
            top: 100px;
            left: 10px;
            background-color: #2196F3;
            display: none;
        }
        #showRatingButton {
            top: 190px;
            left: 10px;
            background-color: #FF9800;
            display: block;
        }
        #result {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 32px;
            font-weight: bold;
            border: 1px solid #ccc;
            z-index: 20;
        }
        #finalMessage {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border: 2px solid black;
            font-size: 36px;
            font-weight: bold;
            text-align: center;
            z-index: 1000;
        }
        #playerSetup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border: 2px solid black;
            z-index: 1000;
        }
        #playersList {
            margin-top: 10px;
            list-style: none;
            padding: 0;
        }
        #startButton {
            margin-top: 10px;
        }
        #timer {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 32px;
            font-weight: bold;
            z-index: 20;
        }
        #ratingTableContainer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border: 2px solid black;
            z-index: 30;
            display: none;
        }
        #ratingTable {
            width: 100%;
            border-collapse: collapse;
        }
        #ratingTable th, #ratingTable td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body>
<div id="panorama"></div>
<div id="miniMapContainer">
    <div id="miniMap"></div>
</div>
<button id="miniMapButton">Карта</button>
<button id="guessButton">Угадай</button>
<button id="nextRoundButton">Следующий раунд</button>
<button id="showRatingButton">Показать рейтинг</button>
<div id="result"></div>
<div id="finalMessage"></div>
<div id="playerSetup">
    <label for="playerName">Введите ваше имя:</label>
    <input type="text" id="playerName">
    <button id="addPlayer">Добавить игрока</button>
    <ul id="playersList"></ul>
    <button id="startButton" disabled>Начать</button>
</div>
<div id="timer"></div>
<div id="ratingTableContainer"></div>

<script>
    // Основная логика уже включена в твой предыдущий скрипт.
    // Добавим обработчик для кнопки "Показать рейтинг":
    document.getElementById('showRatingButton').addEventListener('click', () => {
        fetchRatingData();
    });

    // Функция fetchRatingData и displayRatingTable уже должны быть определены в основном скрипте.
    // Убедись, что они присутствуют. Ниже пример, если нужно:

    function fetchRatingData() {
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwi3rDwL9mnZijV1SvQog44PGD62G-27lFKs0oMEJLDYDobC42y7cKrgs_ViGmYkKGT/exec';
        fetch(scriptURL)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Ошибка сети или проблема с сервером');
                }
                return response.json();
            })
            .then(responseData => {
                if (responseData && responseData.data) {
                    displayRatingTable(responseData.data);
                } else {
                    console.error('Ошибка: Неверный формат данных от сервера');
                }
            })
            .catch(error => console.error('Ошибка при загрузке рейтинга:', error));
    }

    function displayRatingTable(data) {
        const tableContainer = document.getElementById('ratingTableContainer');
        tableContainer.innerHTML = '';

        if (data.length === 0) {
            tableContainer.innerHTML = '<p>Рейтинг пока пуст.</p>';
            tableContainer.style.display = 'block';
            return;
        }

        const table = document.createElement('table');
        table.id = 'ratingTable';

        const headerRow = table.insertRow();
        const headers = data[0];
        headers.forEach(headerText => {
            const header = document.createElement('th');
            header.textContent = headerText;
            headerRow.appendChild(header);
        });

        for (let i = 1; i < data.length; i++) {
            const row = table.insertRow();
            data[i].forEach(cellData => {
                const cell = row.insertCell();
                cell.textContent = cellData;
            });
        }

        tableContainer.appendChild(table);
        tableContainer.style.display = 'block';
    }

    function hideRatingTable() {
        document.getElementById('ratingTableContainer').style.display = 'none';
    }
</script>
</body>
</html>
